"use strict";var _createClass=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(function(){var f,e;function t(e){_classCallCheck(this,t),this.initializeFilter=this.initializeFilter.bind(this),this.initializeRatingFilter=this.initializeRatingFilter.bind(this),this.filterContributions=this.filterContributions.bind(this),this.initializeTabs=this.initializeTabs.bind(this),this.activateTab=this.activateTab.bind(this),this.initializeAttachmentFields=this.initializeAttachmentFields.bind(this),this.initializeFieldToggler=this.initializeFieldToggler.bind(this),this.initializeValidation=this.initializeValidation.bind(this),this.initializeVoting=this.initializeVoting.bind(this),this.initializeNotifications=this.initializeNotifications.bind(this),this.initializeModal=this.initializeModal.bind(this),this.initializeFlagging=this.initializeFlagging.bind(this),this.handleModalAjaxResponse=this.handleModalAjaxResponse.bind(this),this.showModal=this.showModal.bind(this),this.hideModal=this.hideModal.bind(this),this.refreshNonce=this.refreshNonce.bind(this),this.initializeReviewEditing=this.initializeReviewEditing.bind(this),this.initializeReviewUpdating=this.initializeReviewUpdating.bind(this),this.checkReviewUpdated=this.checkReviewUpdated.bind(this),this.options=e,e=window.location.hash&&0===window.location.hash.indexOf("share")?window.location.hash.split("-")[1]:null,this.options.comment_type=this.options.comment_type||e,this.initializeModal(),this.initializeTabs(),this.initializeRadioButtons(),this.initializeAttachmentFields(),this.initializeRatingFields(),this.initializeFieldToggler(),this.initializeValidation(),this.initializeVoting(),this.initializeNotifications(),this.initializeFlagging(),this.initializeTips(),this.initializeFilter(),this.initializeRatingFilter(),this.initializeReviewEditing(),this.initializeDefaultReviewEditing(),this.initializeReviewUpdating(),this.checkReviewUpdated(),this.removeReviewAttachment(),this.emptyReviewAttchmentURL(),this.checkGuestSaveReview(),this.initializeGuestWatch(),this.submitGuestWatch()}f=jQuery,_createClass(t,[{key:"initializeFilter",value:function(){var t=this;return f(".contributions-filter select").on("change",function(e){e=f(e.currentTarget);return t.filterContributions(e.val())}),f(".js-clear-filters").on("click",function(e){return e.preventDefault(),f(".contributions-filter select").val("").trigger("change")})}},{key:"initializeRatingFilter",value:function(){var t=this;return f("#reviews .product-rating-details a").on("click",function(e){return e.preventDefault(),e=f(e.currentTarget),f(".contributions-filter select").val("comment_type=review"),t.filterContributions(decodeURIComponent(e.attr("href")).split("comments_filter=")[1].split("#")[0])})}},{key:"filterContributions",value:function(e){var t=this;return f("#contributions-list-title").text(this.options.i18n.loading),f("#contributions-list .contributions-container").empty().addClass("loading"),f.get(this.options.ajax_url,{action:"wc_product_reviews_pro_contributions_list",product_id:this.options.product_id,comments_filter:e},function(e){return f("#contributions-list").html(e),t.hideFlagForms(),t.initializeFieldToggler(),t.initializeTips()}),e?f(".js-clear-filters").show():f(".js-clear-filters").hide()}},{key:"initializeRadioButtons",value:function(){return f("#reviews").on("click",".form-contribution input[type='radio']",function(e){var t=e.currentTarget,i=f(t),e=i.closest(".form-row");if(!e.hasClass("validate-required"))return t.value===e.attr("data-prev-value")?(i.prop("checked",!1).trigger("change"),e.attr("data-prev-value","")):e.attr("data-prev-value",t.value)})}},{key:"initializeTabs",value:function(){var t=this;return this.$contributionTabs=f(".contribution-form-wrapper"),this.options.comment_type&&"contribution_comment"!==this.options.comment_type&&this.activateTab(this.options.comment_type),f(".js-switch-contribution-type").on("click",function(e){return e.preventDefault(),e=f(e.currentTarget),t.activateTab(e.attr("href").split("-")[1])})}},{key:"activateTab",value:function(e){return this.$contributionTabs.removeClass("active"),this.$contributionTabs.filter("#"+e+"_form_wrapper").addClass("active"),f('.js-switch-contribution-type[href="#share-'+e+'"]').addClass("active").siblings(".active").removeClass("active")}},{key:"initializeRatingFields",value:function(){return f("#review_rating_field").each(function(e,t){var t=f(t),n=f('<span class="star-label" data-selected-text="" />');return t.append(n),t.find("label.checkbox").each(function(e,t){var i=f(t);return i.hover(function(){return n.text(i.text())},function(){return n.text(n.data("selected-text"))})}),t.find("input").on("change",function(){var e=f(this).siblings('label.checkbox[for="review_rating_'+f(this).val()+'"]').text();return n.text(e).data("selected-text",e)})})}},{key:"initializeAttachmentFields",value:function(){var c=this;return f(".form-contribution .attachment-url").each(function(e,t){var i=f(t),t=i.closest("form").find(".attachment-file");if(t.length)return i.add(t).prepend('<a href="#" class="toggle-attachment-source"></a>')}),f(".form-contribution .attachment-type").each(function(e,t){var i,n=f(t),r=n.closest("form"),a=r.find('input[name="comment_type"]').val(),t=n.find("input"),o=r.find(".attachment-url"),s=r.find(".attachment-file");return-1===f.inArray(a,["video","photo"])&&o.hide(),s.hide(),i=function(e){return o.find(".toggle-attachment-source").text(c.options.i18n["attach_"+e+"_file"]),s.find(".toggle-attachment-source").text(c.options.i18n["attach_"+e+"_url"])},t.val()&&i(t.val()),t.on("change",function(e){var t=e.currentTarget,e=f(t),t=t.value;return e.is(":checked")&&t?(i(t),"video"===t?(s.hide(),o.find(".toggle-attachment-source").hide()):o.find(".toggle-attachment-source").show(),o.is(":visible")||s.is(":visible")?void 0:o.slideDown("fast")):(o.slideUp("fast"),s.slideUp("fast"))}).each(function(e,t){return n=f(t),t=t.value,n.next("label.checkbox").attr("title",c.options.i18n["attach_a_"+t]).addClass("js-tip")}),n.find("label:first-child").hide(),r.find(".toggle-attachment-source").on("click",function(e){return e.preventDefault(),s.slideToggle("fast"),o.slideToggle("fast")}),s.on("change","input",function(e){var t=e.currentTarget,e=f(t);if(e.siblings(".wc-product-reviews-pro-validation-error").remove(),!t.files[0].type.match("image.*"))return e.after('<span class="wc-product-reviews-pro-validation-error">'+c.options.i18n.file_not_allowed+"</span>")})})}},{key:"initializeFieldToggler",value:function(){var n=this;return f(".form-contribution:not(.field-toggler-initialized)").each(function(e,t){var i=f(t),t=i.find('input[name="comment_type"]').val();if(f(".star-rating-selector:not(.validate-required )").insertAfter("#review_comment_field"),n.options.comment_type!==t)return i.find(".form-row:not(:first)").hide(),i.find(".wc-product-reviews-pro-form-submit-row").hide(),i.find(".form-row:first").find("input, textarea, select").one("focus change",function(e){var t=f(e.currentTarget).closest("form"),e=t.find('input[name="comment_type"]').val();return"photo"!==e&&"video"!==e?(t.find(".form-row:hidden:not(:contains(.input-hidden)):not(.attachment-source)").slideDown("fast"),t.find(".wc-product-reviews-pro-form-submit-row:hidden:not(:contains(.input-hidden)):not(.attachment-source)").slideDown("fast")):"photo"===e?(t.find(".form-row:hidden:not(:contains(.input-hidden)):not(.attachment-file)").slideDown("fast"),t.find(".wc-product-reviews-pro-form-submit-row:hidden:not(:contains(.input-hidden)):not(.attachment-file)").slideDown("fast")):(t.find(".form-row:hidden:not(:contains(.input-hidden))").slideDown("fast"),t.find(".wc-product-reviews-pro-form-submit-row:hidden:not(:contains(.input-hidden))").slideDown("fast"))}),i.addClass("field-toggler-initialized")})}},{key:"initializeValidation",value:function(){var u=this;return f("#reviews").on("submit",".form-contribution",function(e){var t,s,c,i,l;if(e.preventDefault(),t=f(e.currentTarget),l=t.find('input[name="comment_type"]').val(),t.find(".wc-product-reviews-pro-validation-error").remove(),c=u.options.file_size_max,s=0,t.find("input,select,textarea").each(function(e,t){var i,n,r=f(t),a=r.attr("name"),o=r.val();switch(r.closest(".form-row").hasClass("validate-required")&&"review_rating"!==a&&!o&&(r.after('<span class="wc-product-reviews-pro-validation-error">'+u.options.i18n.error_required+"</span>"),s++),a){case l+"_comment":if(o=(i=r).data("min-word-count"),n=i.data("max-word-count"),o||n){if(a=f.trim(i.val()).split(" ").length,o&&a<o)return i.after('<span class="wc-product-reviews-pro-validation-error">'+u.options.i18n.error_too_short.replace(/%d/g,o)+"</span>"),s++;if(n&&n<a)return i.after('<span class="wc-product-reviews-pro-validation-error">'+u.options.i18n.error_too_long.replace(/%d/g,n)+"</span>"),s++}break;case l+"_attachment_file":if(n=null,"undefined"!=typeof FileReader&&null!==FileReader&&0<t.files.length&&(n=t.files[0].size),null!=n&&c<n)return r.after('<span class="wc-product-reviews-pro-validation-error">'+u.options.i18n.error_file_size_max+"</span>"),s++}}),"photo"===l&&(e=t.find(".attachment-url input").val(),i=t.find(".attachment-file input").val(),e||i||(t.find(".attachment-url input").after('<span class="wc-product-reviews-pro-validation-error">'+u.options.i18n.error_attach_file+"</span>"),t.find(".attachment-file input").after('<span class="wc-product-reviews-pro-validation-error">'+u.options.i18n.error_attach_file+"</span>"))),!s)return i=function(){return t.get(0).submit()},!u.options.is_user_logged_in&&u.options.comment_registration?(f(".guest-switcher").data("target","form-contribution"),f("#guest_login, .guest-switcher, .switcher .login").hide(),f("#customer_login, .switcher .register").show(),u.showModal().one("login",i)):i()})}},{key:"initializeVoting",value:function(){var c=this;return f("#comments").on("click",".contribution-actions .vote",function(e){var t,i,n,r,a,o,s;return e.preventDefault(),r=f(e.currentTarget),o=r.hasClass("vote-down")?"negative":"positive",a=r.data("comment-id"),t=r.siblings(".feedback").html(""),n=r.siblings(".vote-count-positive"),i=r.siblings(".vote-count-negative"),s=r.hasClass("done"),e=function(){return f.ajax({type:"POST",url:c.options.ajax_url,data:{action:"wc_product_reviews_pro_vote",security:c.options.nonce,vote:o,comment_id:a},success:function(e){return t.css("display","inline-block"),setTimeout(function(){return t.fadeOut()},2e3),e.data&&e.data.message?(t.text(e.data.message),e.success?(t.removeClass("error"),n.text("("+e.data.positive_votes+")"),i.text("("+e.data.negative_votes+")"),r.removeClass("done").siblings(".vote").removeClass("done"),s||r.addClass("done"),e=e.data.positive_votes||e.data.negative_votes?c.options.i18n.comment_karma.replace("%1$d",e.data.positive_votes).replace("%2$d",e.data.total_votes):"",r.closest(".comment_container").find(".contribution-karma").text(e)):t.addClass("error")):t.text(c.options.i18n.vote_failed).addClass("error")}})},c.options.is_user_logged_in?e():(f(".guest-switcher").data("target","vote"),f("#guest_login, .guest-switcher, .switcher .login").hide(),f("#customer_login, .switcher .register").show(),c.showModal().one("login",e))})}},{key:"initializeNotifications",value:function(){var a=this;return f("#comments").on("click",".contribution-actions .notifications",function(e){var t,i,n,r;return e.preventDefault(),i=f(e.currentTarget),r=i.hasClass("subscribe")?"subscribe":"unsubscribe",n=i.data("comment-id"),t=i.siblings(".feedback").html(""),e=function(){return f.ajax({type:"POST",url:a.options.ajax_url,data:{action:"wc_product_reviews_pro_notify_replies",security:a.options.nonce,manage:r,user_id:a.options.user_id,comment_id:n},success:function(e){return t.css("display","inline-block"),setTimeout(function(){return t.fadeOut()},2e3),e.data&&e.data.message?(t.text(e.data.message),e.success?(i.hide(),("subscribe"==r?i.parent().find(".unsubscribe"):i.parent().find(".subscribe")).show(),t.removeClass("error")):t.addClass("error")):t.text(a.options.i18n.subscribe_failed).addClass("error")}})},a.options.is_user_logged_in?e():(f(".guest-switcher").data("target","notification"),f("#guest_login, .switcher .login").hide(),f("#customer_login, .guest-switcher, .switcher .register").show(),f("#guest-comment-id").val(n),a.showModal().one("login",e))})}},{key:"initializeModal",value:function(){var t,i=this;return this.$modal=t=f("#wc-product-reviews-pro-modal"),this.$overlay=f("#wc-product-reviews-pro-modal-overlay"),this.$modalContainer=f("#wc-product-reviews-pro-modal-container"),t.find("a.close").on("click",function(e){return e.preventDefault(),i.hideModal()}),t.find(".switcher a").on("click",function(e){return e.preventDefault(),f(e.currentTarget).closest(".switcher").find("p").toggle(),t.find(".col-1, .col-2").toggle().filter(":visible").find(".woocommerce-Input").first().focus()}),t.find("form.login").on("submit",function(e){var t;return e.preventDefault(),e=(t=f(e.currentTarget)).find("#woocommerce-login-nonce").val(),f.post(i.options.ajax_url,{username:t.find("#username").val(),password:t.find("#password").val(),_wpnonce:e,login:1,_wc_product_reviews_pro_ajax_login:1},function(e){return i.handleModalAjaxResponse(e,t)})}),t.find("form.register").on("submit",function(e){var t;return e.preventDefault(),e=(t=f(e.currentTarget)).find("#woocommerce-register-nonce").val(),f.post(i.options.ajax_url,{email:t.find("#reg_email").val(),username:t.find("#reg_username").val(),password:t.find("#reg_password").val(),register:t.find('[name="register"]').val(),_wpnonce:e,_wc_product_reviews_pro_ajax_register:!0},function(e){return i.handleModalAjaxResponse(e,t)})}),f("#reviews").on("click",".js-wc-product-reviews-pro-show-login-modal",function(e){if(e.preventDefault(),!i.options.is_user_logged_in)return f(".guest-switcher").data("target","js-wc-product-reviews-pro-show-login-modal"),f("#guest_login, .guest-switcher, .switcher .login").hide(),f("#customer_login, .switcher .register").show(),i.showModal().one("login",function(){return window.location.assign(window.location.toString()+"#reviews"),window.location.reload()})})}},{key:"hideFlagForms",value:function(){return f(".contribution-flag-form").hide()}},{key:"initializeFlagging",value:function(){var r=this;return this.hideFlagForms(),f("#comments").on("click",".contribution-actions .js-toggle-flag-form",function(e){return e.preventDefault(),e=f(e.currentTarget),f(".flag-response").remove(),e=e.data("comment-id"),f("form#flag-contribution-"+e).slideDown("fast").find("button").removeProp("disabled")}),f("#reviews").on("submit",".contribution-flag-form",function(e){var t,i,n;return e.preventDefault(),(i=f(e.currentTarget)).find("button").attr("disabled",!0),t=i.siblings(".contribution-actions").find(".feedback").html(""),n=i.find('input[name="comment_id"]').val(),e=i.find('input[name="flag_reason"]').val(),f.ajax({type:"POST",url:r.options.ajax_url,data:{action:"wc_product_reviews_pro_flag",security:r.options.nonce,comment_id:n,reason:e},success:function(e){return i.slideUp("fast").find("button").removeAttr("disabled"),t.show(),setTimeout(function(){return t.fadeOut()},2e3),e.data&&e.data.message?(t.text(e.data.message),e.success?(t.removeClass("error"),i.prev(".comment_container").find(".js-toggle-flag-form").addClass("done")):t.addClass("error")):t.text(this.options.i18n.flag_failed).addClass("error")}})})}},{key:"initializeTips",value:function(){return f(".js-tip").tipTip({attribute:"title",fadeIn:50,fadeOut:50,delay:200})}},{key:"handleModalAjaxResponse",value:function(e,t){var i,n=this;return e.success?this.refreshNonce(function(e){return n.options.is_user_logged_in=!0,t.prevAll(".woocommerce-error").remove(),n.hideModal().trigger("login")}):(t.prevAll(".woocommerce-error").remove(),t.before(null!=(i=null!=e&&null!=(i=e.data)?i.message:void 0)?i:this.options.i18n.error_login_signup))}},{key:"showModal",value:function(){var t=this,e=this.$modal,i=this.$overlay;this.$modalContainer;return f(document).on("keydown.modal",function(e){if(27===e.keyCode)return t.hideModal()}),i.fadeIn(100).on("click.modal",function(){return t.hideModal()}),f("body").addClass("wc-prp-modal"),e.find(".col-1").show().find(".woocommerce-Input").first().focus(),e.find(".col-2").hide(),e.trigger("showmodal")}},{key:"hideModal",value:function(){return f(document).off("keydown.modal"),f("body").removeClass("wc-prp-modal"),this.$overlay.hide().off("click.modal"),this.$modal.trigger("hidemodal")}},{key:"refreshNonce",value:function(r){var a=this;return f.get(this.options.ajax_url,{action:"wc_product_reviews_pro_refresh_nonce"}).done(function(e){var t,i,n;return a.options.nonce=null!=e&&null!=(t=e.data)?t.nonce:void 0,a.options.user_id=null!=e&&null!=(i=e.data)?i.user_id:void 0,r(null!=e&&null!=(n=e.data)?n.nonce:void 0)})}},{key:"initializeReviewEditing",value:function(){var l=this;return f("#reviews").on("click",".edit-comment",function(e){var o,s,c;return e.preventDefault(),e=f(e.currentTarget),s=e.siblings(".feedback").html(""),o=e.data("comment-id"),e=f('input[name="comment_post_ID"]').val(),c=f(".form-review"),f.ajax({type:"POST",url:l.options.ajax_url,data:{action:"wc_product_reviews_pro_get_review",security:l.options.nonce,comment_id:o,product_id:e},success:function(e){var t,i,n,r,a;return c[0].reset(),c.find(".review_attachment").remove(),e.success?(s.removeClass("error"),f("html, body").animate({scrollTop:f("#review_form_wrapper").offset().top-100},"medium"),a=e.data.review,f("#review_title").val(a.title),f("#review_comment").val(a.content),f("#comment_ID").val(o),c.find(".attachment-file").hide(),c.find(".attachment-url").hide(),""!==a.rating&&f("#review_rating_"+a.rating).prop("checked",!0),""!==a.attachment_type&&(f('input[name="review_attachment_type"]').prop("checked",!1),f("#review_attachment_type_"+a.attachment_type).prop("checked",!0),f("#review_attachment_type_field").data("prev-value",a.attachment_type)),n=":not(.attachment-url)",""!==a.attachment_url&&(f("#review_attachment_url").val(a.attachment_url),n=""),i=":not(.attachment-file)",""!==a.attachment_id&&(i="",r=f("<a>").addClass("remove_attachment").attr("href","#").text(l.options.i18n.remove_attachment),t=f("<img>").attr("src",a.attachment_file_url),(r=f("<div>").addClass("review_attachment").html(r)).append(t),c.find(".attachment-file").append(r)),"yes"===a.subscribed?f("#subscribe_to_replies").prop("checked",!0):f("#subscribe_to_replies").prop("checked",!1),f(".star-rating-selector").removeClass("change-rating"),f("#review_form_wrapper").hasClass("loading")&&f("#review_form_wrapper").removeClass("loading"),c.find(".form-row:hidden:not(:contains(.input-hidden))"+n+i).slideDown("fast"),c.find(".wc-product-reviews-pro-form-submit-row:hidden:not(:contains(.input-hidden))"+n+i).slideDown("fast")):(s.addClass("error"),s.text(e.data.message),setTimeout(function(){return s.fadeOut()},2e3))}})})}},{key:"initializeReviewUpdating",value:function(){var m=this;return f(".form-review").on("click",".update-review",function(e){var t,i,n,r,a,o,s,c,l,u,d,p,h=f("#review_comment").val();if(""!==h)return u=f(".form-review .response"),d=f("#review_title").val(),n=f("#comment_ID").val(),s=f('input[name="comment_post_ID"]').val(),c=f('input[name="review_rating"]:checked').val(),i=f("#review_attachment_url").val(),l=f(".form-review .remove_attachment").length,(r=0)<f("#review_attachment_file").length&&0<f("#review_attachment_file")[0].files.length?(a=f("#review_attachment_file")[0].files[0],r=1):a="",t=0<f('input[name="review_attachment_type"]:checked').length?f('input[name="review_attachment_type"]:checked').val():"",p=f("#subscribe_to_replies").is(":checked")?"yes":"no",(o=new FormData).append("action","wc_product_reviews_pro_update_review"),o.append("security",m.options.nonce),o.append("review_title",d),o.append("review_content",h),o.append("comment_id",n),o.append("product_id",s),o.append("rating",c),o.append("attachment_url",i),o.append("attachment_type",t),o.append("delete_attachment",l),o.append("files",a),o.append("file_changed",r),o.append("subscribed",p),f.ajax({type:"POST",url:m.options.ajax_url,data:o,processData:!1,contentType:!1,success:function(e){return u.text(e.data.message),u.css("display","inline-block"),e.success?(u.removeClass("error"),setTimeout(function(){var e=-1!==window.location.href.indexOf("?")?"&":"?";return window.location.href=window.location.href+e+"updated="+n},2e3)):u.addClass("error")}});f("#review_comment").after('<span class="wc-product-reviews-pro-validation-error">'+m.options.i18n.error_required+"</span>")})}},{key:"checkReviewUpdated",value:function(){var e=window.location.href,e=new RegExp("[?&]updated(=([^&#]*)|&|#|$)").exec(e);if(e&&e[2])return e=decodeURIComponent(e[2].replace(/\+/g," ")),f(".wc-tabs li").removeClass("active"),f(".wc-tabs li.reviews_tab").addClass("active"),f(".wc-tabs-wrapper .wc-tab").hide(),f("#tab-reviews").show(),f("html, body").animate({scrollTop:f("#comment-"+e).offset().top-100},"medium"),window.history.replaceState(null,null,location.href.replace(/&?[&?]updated=([^&]$|[^&]*)/i,""))}},{key:"removeReviewAttachment",value:function(){return f(".form-review").on("click",".remove_attachment",function(e){return e.preventDefault(),f(".form-review").find(".review_attachment").remove()})}},{key:"emptyReviewAttchmentURL",value:function(){return f("#review_attachment_file").on("change",function(e){return f("#review_attachment_url").val("")})}},{key:"initializeDefaultReviewEditing",value:function(){var t=this;return f(".form-review").on("click",".change-rating",function(e){return e.preventDefault(),f("#review_form_wrapper").addClass("loading"),e=f('input[name="comment_post_ID"]').val(),f.ajax({type:"POST",url:t.options.ajax_url,data:{action:"wc_product_reviews_pro_get_recent_review",security:t.options.nonce,product_id:e},success:function(e){if(e.success)return e=e.data.review,f("#comment-"+e+" .edit-comment").trigger("click")}})})}},{key:"checkGuestSaveReview",value:function(){var p=this;return f(".form-review").on("click","button[type=submit]",function(e){var c,l,u,d;if(!p.options.is_user_logged_in)return e.preventDefault(),p.options.comment_registration?(f(".guest-switcher").data("target","form-contribution"),f("#guest_login, .guest-switcher, .switcher .login").hide(),f("#customer_login, .switcher .register").show(),p.showModal().one("login",function(){return f(".form-review").get(0).submit()})):(c=f("#review_email").val(),d=f("#review_comment").val(),e=f("#review_author").val(),l=f('input[name="comment_post_ID"]').val(),u=f(".form-review .response"),""!==d&&""!==c&&""!==e?f.ajax({type:"POST",url:p.options.ajax_url,data:{action:"wc_product_reviews_pro_check_review",security:p.options.nonce,email:c,product_id:l},success:function(e){var t,i,n,r,a,o,s;return e.success?(u.removeClass("error").text("").css("display","none"),0<parseInt(e.data.count)?confirm(p.options.i18n.review_update_confirmation)?(s=f("#review_title").val(),a=f('input[name="review_rating"]:checked').val(),i=f("#review_attachment_url").val(),o=f(".form-review .remove_attachment").length,n=0<f("#review_attachment_file")[0].files.length?f("#review_attachment_file")[0].files[0]:"",t=0<f('input[name="review_attachment_type"]:checked').length?f('input[name="review_attachment_type"]:checked').val():"",(r=new FormData).append("action","wc_product_reviews_pro_review_update_confirmation"),r.append("security",p.options.nonce),r.append("email",c),r.append("review_title",s),r.append("review_content",d),r.append("product_id",l),r.append("rating",a),r.append("attachment_url",i),r.append("attachment_type",t),r.append("delete_attachment",o),r.append("files",n),f.ajax({type:"POST",url:p.options.ajax_url,data:r,processData:!1,contentType:!1,success:function(e){return(e.success?u.removeClass("error"):u.addClass("error")).text(e.data.message).css("display","inline-block"),setTimeout(function(){return u.fadeOut()},2e3)}})):void 0:f(".form-review").submit()):void 0!==e.data.type?alert(e.data.message):(u.addClass("error").text(e.data.message).css("display","inline-block"),setTimeout(function(){return u.fadeOut()},2e3))}}):void f(".form-review").submit())})}},{key:"initializeGuestWatch",value:function(){return f("#wc-product-reviews-pro-modal").on("click",".guest-link",function(e){return e.preventDefault(),f("#guest_login, #guest_login .col-1, .switcher .login, .switcher .register").show(),f("#customer_login, .guest-switcher").hide()}),f("#wc-product-reviews-pro-modal").on("click",".switcher .register a",function(e){return e.preventDefault(),f("#guest_login, #customer_login .col-1, .switcher .register").hide(),f("#customer_login, #customer_login .col-2, .switcher .login").show(),"notification"===f(".guest-switcher").data("target")?f(".guest-switcher").show():f(".guest-switcher").hide()}),f("#wc-product-reviews-pro-modal").on("click",".switcher .login a",function(e){return e.preventDefault(),f("#guest_login, #customer_login .col-2, .switcher .login").hide(),f("#customer_login, #customer_login .col-1, .guest-switcher, .switcher .register").show(),"notification"===f(".guest-switcher").data("target")?f(".guest-switcher").show():f(".guest-switcher").hide()})}},{key:"submitGuestWatch",value:function(){var r=this;return f(".woocommerce-form-guest").on("click",".guest-watch",function(e){var t,i,n;return e.preventDefault(),t=f("#guest_email").val(),n=f('input[name="wc-product-review-pro-guest-nonce"]').val(),e=f("#guest-comment-id").val(),i=f("#comment-"+e).find(".contribution-actions .feedback").html(""),f.ajax({type:"POST",url:r.options.ajax_url,data:{action:"wc_product_reviews_pro_guest_watch",security:n,email:t,comment_id:e},success:function(e){return e.success?(r.hideModal(),i.css("display","inline-block"),setTimeout(function(){return i.fadeOut()},2e3),i.removeClass("error"),i.text(e.data.message)):(i.css("display","none"),i.text(""),f("#guest_login .woocommerce-error").remove(),f('<ul class="woocommerce-error"><li>'+e.data.message+"</li></ul>").insertBefore(".woocommerce-form-guest"))}})})}}]),e=t,f(window).load(function(){return new e(window.wc_product_reviews_pro)})}).call(void 0);